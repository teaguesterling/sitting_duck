# name: test/sql/native_extraction/dart_extraction.test
# description: Comprehensive native extraction tests for Dart
# group: [native_extraction]

require sitting_duck

statement ok
LOAD sitting_duck;

# =============================================================================
# Dart Native Extraction Model Tests
# =============================================================================
#
# Updated extraction model:
#   - name: The identifier (class name, mixin name, etc.)
#   - signature_type: Type info (class, abstract_class, mixin, enum, extension)
#   - parameters: LIST(STRUCT(name, type)) - parent types with inheritance kind
#       * name: parent class/interface/mixin name
#       * type: inheritance kind (extends, implements, with)
#   - modifiers: Keywords (abstract, sealed, final, etc.) - NO inheritance keywords
# =============================================================================

# =============================================================================
# CLASS_DEFINITION - Class Declarations with Inheritance
# =============================================================================

# Test: Abstract base class with no inheritance
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'class_definition' AND name = 'Animal';
----
Animal	abstract_class	[]	[abstract]

# Test: Class extending another class
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'class_definition' AND name = 'Dog';
----
Dog	class	[{'name': Animal, 'type': extends}]	[]

# Test: Class with extends and implements
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'class_definition' AND name = 'Pet';
----
Pet	[{'name': Dog, 'type': extends}, {'name': Runnable, 'type': implements}]	[]

# Test: Class with extends, implements, and with (mixin)
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'class_definition' AND name = 'ServiceAnimal';
----
ServiceAnimal	[{'name': Dog, 'type': extends}, {'name': Loggable, 'type': with}, {'name': Runnable, 'type': implements}]	[]

# Test: Sealed class
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'class_definition' AND name = 'Shape';
----
Shape	sealed_class	[]	[sealed]

# Test: Class extending sealed class
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'class_definition' AND name = 'Circle';
----
Circle	[{'name': Shape, 'type': extends}]	[]

# =============================================================================
# MIXIN_DECLARATION - Mixin Declarations
# =============================================================================

# Test: Simple mixin with no constraints
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'mixin_declaration' AND name = 'Loggable';
----
Loggable	mixin	[]	[]

# Test: Mixin with 'on' clause (Runner mixin on Animal)
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'mixin_declaration' AND name = 'Runner';
----
Runner	mixin	[]	[]

# =============================================================================
# ENUM_DECLARATION - Enum Declarations
# =============================================================================

# Test: Enum with mixin
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'enum_declaration' AND name = 'DogBreed';
----
DogBreed	[{'name': Loggable, 'type': with}]	[]

# =============================================================================
# Simple class with no inheritance
# =============================================================================

# Test: Interface class (abstract class used as interface)
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/dart/Inheritance.dart', context := 'native')
WHERE type = 'class_definition' AND name = 'Runnable';
----
Runnable	abstract_class	[]	[abstract]

