# name: test/sql/native_extraction/java_extraction.test
# description: Comprehensive native extraction tests for Java
# group: [native_extraction]

require sitting_duck

statement ok
LOAD sitting_duck;

# =============================================================================
# Java Native Extraction Model Tests
# =============================================================================
#
# Updated extraction model:
#   - name: The identifier (function name, method name, class name)
#   - qualified_name: Full path (for calls: obj.method, for others: module.class.method)
#   - signature_type: Type info (return type for functions, class kind, NULL for calls)
#   - parameters: LIST(STRUCT(name, type)) - parent classes/interfaces with inheritance kind
#   - modifiers: Keywords/flags (access modifiers, annotations)
# =============================================================================

# =============================================================================
# DEFINITION_CLASS - Class Declarations with Inheritance
# =============================================================================

# Test: Abstract base class with no inheritance - abstract modifier present
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'class_declaration' AND name = 'Animal';
----
Animal	abstract_class	[]	[abstract]

# Test: Class with single extends - parent in parameters with type="extends"
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'class_declaration' AND name = 'Dog';
----
Dog	class	[{'name': Animal, 'type': extends}]	[]

# Test: Class with extends and implements - both parents in parameters with their inheritance kind
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'class_declaration' AND name = 'Pet';
----
Pet	[{'name': Dog, 'type': extends}, {'name': Serializable, 'type': implements}]	[]

# Test: Class with extends and multiple implements
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'class_declaration' AND name = 'ServiceAnimal';
----
ServiceAnimal	[{'name': Dog, 'type': extends}, {'name': Runnable, 'type': implements}, {'name': Serializable, 'type': implements}]	[]

# =============================================================================
# DEFINITION_INTERFACE - Interface Declarations
# =============================================================================

# Test: Simple interface with no extends
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'interface_declaration' AND name = 'Runnable';
----
Runnable	interface	[]	[interface]

# Test: Interface extending another interface
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'interface_declaration' AND name = 'Runner';
----
Runner	[{'name': Runnable, 'type': extends}]	[interface]

# Test: Interface extending multiple interfaces
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'interface_declaration' AND name = 'Athlete';
----
Athlete	[{'name': Runner, 'type': extends}, {'name': Serializable, 'type': extends}]	[interface]

# Test: Functional interface with annotation
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'interface_declaration' AND name = 'SoundMaker';
----
SoundMaker	functional_interface	[]	[interface, @FunctionalInterface]

# =============================================================================
# DEFINITION_ENUM - Enum Declarations
# =============================================================================

# Test: Enum implementing an interface
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/java/Inheritance.java', context := 'native')
WHERE type = 'enum_declaration' AND name = 'DogBreed';
----
DogBreed	[{'name': Serializable, 'type': implements}]	[enum]

