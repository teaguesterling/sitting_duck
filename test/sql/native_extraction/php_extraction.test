# name: test/sql/native_extraction/php_extraction.test
# description: Comprehensive native extraction tests for PHP
# group: [native_extraction]

require sitting_duck

statement ok
LOAD sitting_duck;

# =============================================================================
# PHP Native Extraction Model Tests
# =============================================================================
#
# Updated extraction model:
#   - name: The identifier (class name, interface name, etc.)
#   - signature_type: Type info (class, abstract_class, interface, trait, enum)
#   - parameters: Parent types (extended class, implemented interfaces)
#   - modifiers: Keywords (extends, implements, abstract, final)
# =============================================================================

# =============================================================================
# INTERFACE_DECLARATION - Interface Declarations
# =============================================================================

# Test: Simple interface with no extends
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'interface_declaration' AND name = 'Runnable';
----
Runnable	interface	[]	[]

# Test: Interface extending another interface
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'interface_declaration' AND name = 'Runner';
----
Runner	[Runnable]	[extends]

# Test: Interface extending multiple interfaces
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'interface_declaration' AND name = 'Athlete';
----
Athlete	[Runner, Serializable]	[extends]

# =============================================================================
# CLASS_DECLARATION - Class Declarations with Inheritance
# =============================================================================

# Test: Abstract base class with no inheritance
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'class_declaration' AND name = 'Animal';
----
Animal	abstract_class	[]	[abstract]

# Test: Class extending another class
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'class_declaration' AND name = 'Dog';
----
Dog	class	[Animal]	[extends]

# Test: Class with extends and implements
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'class_declaration' AND name = 'Pet';
----
Pet	[Dog, Serializable]	[extends, implements]

# Test: Class with extends and multiple implements
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'class_declaration' AND name = 'ServiceAnimal';
----
ServiceAnimal	[Dog, Runnable, Serializable]	[extends, implements]

# Test: Final class
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'class_declaration' AND name = 'Bulldog';
----
Bulldog	final_class	[Dog]	[extends, final]

# =============================================================================
# TRAIT_DECLARATION - Trait Declarations
# =============================================================================

# Test: Simple trait
query ITTT
SELECT name, signature_type, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'trait_declaration' AND name = 'Loggable';
----
Loggable	trait	[]	[]

# =============================================================================
# ENUM_DECLARATION - Enum Declarations (PHP 8.1+)
# =============================================================================

# Test: Enum implementing an interface
query ITT
SELECT name, parameters, modifiers FROM read_ast('test/data/languages/php/Inheritance.php', context := 'native')
WHERE type = 'enum_declaration' AND name = 'DogBreed';
----
DogBreed	[Serializable]	[implements]

