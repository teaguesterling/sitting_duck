# name: test/sql/languages/swift_language_support.test
# description: Test Swift language support functionality
# group: [sitting_duck]

require sitting_duck

# Test 1: Swift language is supported
# ===================================

query I
SELECT language FROM ast_supported_languages() WHERE language = 'swift';
----
swift

# Test 2: Swift file extension auto-detection
# ===========================================

query I
SELECT COUNT(*) > 0 FROM read_ast('test/data/swift/simple.swift');
----
true

# Test 3: Explicit Swift language specification (platform-tolerant)
# ===================================================================

query I
SELECT COUNT(*) >= 4800 as has_sufficient_named_nodes FROM read_ast('test/data/swift/simple.swift', 'swift') WHERE name IS NOT NULL;
----
1

# Test 4: Swift function declarations (platform-tolerant)
# ========================================================

query I
SELECT COUNT(*) >= 20 as has_functions FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'function_declaration';
----
1

# Test 5: Swift class declarations (platform-tolerant)
# =====================================================

query I
SELECT COUNT(*) >= 10 as has_classes FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'class_declaration';
----
1

# Test 6: Swift property declarations (platform-tolerant)
# ========================================================

query I
SELECT COUNT(*) >= 60 as has_properties FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'property_declaration';
----
1

# Test 7: Swift initializer declarations
# =====================================

query I
SELECT COUNT(*) FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'init_declaration';
----
8

# Test 8: Swift protocol declarations
# ==================================

query I
SELECT COUNT(*) FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'protocol_declaration';
----
2

# Test 9: Swift semantic types for key constructs
# ===============================================
# Note: semantic_type values include refinements that map to base types:
# - class_declaration: DEFINITION_CLASS
# - function_declaration: DEFINITION_FUNCTION
# - property_declaration: DEFINITION_VARIABLE (with FIELD refinement)

query ITI
SELECT type, semantic_type, COUNT(*) as count
FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type IN ('function_declaration', 'class_declaration', 'property_declaration')
GROUP BY type, semantic_type
ORDER BY type;
----
class_declaration	DEFINITION_CLASS	14
function_declaration	DEFINITION_FUNCTION	26
property_declaration	DEFINITION_VARIABLE	75

# Test 10: Swift tree structure validation (platform-tolerant)
# ==============================================================

query I
SELECT MAX(depth) >= 20 AND COUNT(*) >= 4800 as has_deep_tree FROM read_ast('test/data/swift/simple.swift', 'swift');
----
1

# Test 11: Swift identifier extraction (platform-tolerant)
# =========================================================

query I
SELECT COUNT(*) >= 600 as has_identifiers FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'simple_identifier' AND name IS NOT NULL;
----
1

# Test 12: Swift type annotations
# ==============================

query I
SELECT COUNT(*) FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'type_annotation';
----
47

# Test 13: Swift string literals
# ==============================

query I
SELECT COUNT(*) FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type IN ('line_string_literal', 'multi_line_string_literal');
----
78

# Test 14: Swift call expressions
# ===============================

query I
SELECT COUNT(*) FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'call_expression';
----
130

# Test 15: Swift computed properties
# =================================

query I
SELECT COUNT(*) FROM read_ast('test/data/swift/simple.swift', 'swift')
WHERE type = 'computed_property';
----
15